/* import path from 'node:path';
import fse from 'fs-extra'
import { HostEnvironmentDefault } from './hostEnv';
import { findOwnerCsProjectFile, safeReadFile } from './cliUtils';

import {
    Duration, GeneratedFile, Generator, GeneratorHostDataKeys, generatorUtils, isNullOrEmpty, 
    type LhqModel, type GeneratorInitialization,
} from '../src/index';


const fileHeader = `//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool - Localization HQ Editor.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------`;

const templates = [
    'NetCoreResxCsharp01',
    'NetResx',
    'TypescriptJson01',
    'TypescriptJson01Json',
    'NetFwResxCsharp01',
    'WpfResxCsharp01',
    'WinFormsResxCsharp01'
];

export async function generateFromLhq(hbsTemplatesDir: string, lhqFileName: string, csProjectFileName: string, outputDir: string,
    hostData: Record<string, unknown>): Promise<void> {

    if (!(await fse.pathExists(lhqFileName))) {
        throw new Error(`LHQ model file '${lhqFileName}' not found.`);
    }

    if (!isNullOrEmpty(csProjectFileName) && !(await fse.pathExists(csProjectFileName))) {
        throw new Error(`C# project file '${csProjectFileName}' not found.`);
    }

    const generatorInit: GeneratorInitialization = {
        hbsTemplates: {},
        hostEnvironment: new HostEnvironmentDefault()
    };

    if (!(await fse.pathExists(hbsTemplatesDir))) {
        throw new Error(`LHQ templates directory '${hbsTemplatesDir}' not found.`);
    }

    const csProjectFiles = await glob('*.csproj', { cwd: dir, nodir: true });

    const templateLoaders = templates.map(async (templateId) => {
        generatorInit.hbsTemplates[templateId] = await readHbsFile(hbsTemplatesDir, `${templateId}.hbs`);
    });

    await Promise.all(templateLoaders);

    const lhqFile = await safeReadFile(lhqFileName);
    const model = JSON.parse(lhqFile) as LhqModel;

    Generator.initialize(generatorInit);

    let rootNamespace = hostData[GeneratorHostDataKeys.namespace]

    let csProjFound = false;
    if (isNullOrEmpty(rootNamespace)) {
        let t4FileName = '';
        if (isNullOrEmpty(csProjectFileName)) {
            const findResult = await findOwnerCsProjectFile(lhqFileName);

            if (!isNullOrEmpty(findResult.csProjFileName)) {
                console.log(`Found '${csProjectFileName}' associated with '${lhqFileName}'.`);
                csProjFound = true;
                csProjectFileName = findResult.csProjFileName;
                t4FileName = findResult.t4FileName;
                rootNamespace = findResult.namespace;
            }
        } else {
            t4FileName = path.basename(lhqFileName) + '.tt';
        }

        if (isNullOrEmpty(rootNamespace)) {
            let csProjectFileContent = '';
            if (await fse.pathExists(csProjectFileName)) {
                csProjectFileContent = await safeReadFile(csProjectFileName);
            }

            rootNamespace = generatorUtils.getRootNamespaceFromCsProj(path.basename(lhqFileName), t4FileName, csProjectFileName, csProjectFileContent);
        }

        hostData[GeneratorHostDataKeys.namespace] = rootNamespace ?? '';
    }

    if (isNullOrEmpty(hostData[GeneratorHostDataKeys.fileHeader])) {
        hostData[GeneratorHostDataKeys.fileHeader] = fileHeader;
    }

    const generator = new Generator();

    const duration = Duration.start();
    const result = generator.generate(lhqFileName, model, hostData);
    console.log(`Generated ${result.generatedFiles.length} files in ${duration.elapsedTime}.\n------------\n`);

    const output = path.resolve(outputDir);

    console.log(`Output directory: ${output}`);
    const saveFilesMap = result.generatedFiles.map(async (file) => {
        await saveGenFile(generator, file, output);
        console.log(`Saved file ${file.fileName}.`);
    });

    await Promise.all(saveFilesMap);
}

async function saveGenFile(generator: Generator, generatedFile: GeneratedFile, outputPath?: string): Promise<void> {
    const content = generator.getFileContent(generatedFile, true);
    const bom = generatedFile.bom ? '\uFEFF' : '';
    const encodedText = Buffer.from(bom + content, 'utf8');

    const fileName = !outputPath ? generatedFile.fileName : path.join(outputPath, generatedFile.fileName);
    const dir = path.dirname(fileName);

    await fse.ensureDir(dir);
    await fse.writeFile(fileName, encodedText, { encoding: 'utf8' });
}

async function readHbsFile(dir: string, fileName: string): Promise<string> {
    const hbsFile = path.join(dir, fileName);
    if (!(await fse.pathExists(hbsFile))) {
        throw new Error(`LHQ template file '${hbsFile}' not found.`);
    }

    return await safeReadFile(hbsFile);
} */